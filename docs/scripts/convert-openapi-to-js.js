#!/usr/bin/env node

import { readFile, writeFile } from 'fs/promises';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

async function convertOpenApiToJs() {
  try {
    const docsPath = path.join(__dirname, '..');
    const openApiPath = path.join(docsPath, 'api-browser', 'openapi.json');
    const outputPath = path.join(docsPath, 'api-browser', 'openapi-spec.js');

    console.log('Converting OpenAPI JSON to JavaScript module...');

    // Read the OpenAPI JSON
    const openApiContent = await readFile(openApiPath, 'utf8');
    const openApiSpec = JSON.parse(openApiContent);

    // Generate JavaScript module
    const jsContent = `// Auto-generated OpenAPI specification
// Do not edit this file directly - it's generated from openapi.json

export default ${JSON.stringify(openApiSpec, null, 2)};
`;

    // Write the JavaScript module
    await writeFile(outputPath, jsContent, 'utf8');
    console.log(`OpenAPI specification converted to: ${outputPath}`);

  } catch (error) {
    console.error('Error converting OpenAPI to JavaScript:', error);
    process.exit(1);
  }
}

convertOpenApiToJs();